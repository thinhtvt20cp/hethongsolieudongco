<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Quản lý quấn động cơ</title>
<script src="https://script.google.com/macros/s/AKfycbwJyHKqYHSrcV2TEkMvV_ShSQe49LOSzgIOu501HmvsiMr--ycsY1ZqR3MdxmLpddQCQQ/exec"></script>

<style>
body{
font-family:'Tahoma',Tahoma,Arial,sans-serif;
background:linear-gradient(135deg,#0f172a,#14532d);
padding:25px;
color:#0f172a
}

.container{
max-width:1300px;
margin:auto
}


.header{
background:linear-gradient(135deg,#22c55e,#15803d);
color:white;
padding:26px;
border-radius:24px;
text-align:center;
font-size:32px;
font-weight:900;
letter-spacing:1.5px;
box-shadow:0 20px 40px rgba(0,0,0,.35);
backdrop-filter:blur(6px)
}


.card{
background:rgba(255,255,255,.95);
padding:22px;
border-radius:22px;
margin:20px 0;
box-shadow:0 18px 35px rgba(0,0,0,.18);
transition:.25s
}

.card:hover{
transform:translateY(-4px);
box-shadow:0 25px 50px rgba(0,0,0,.25)
}


h3{
color:#14532d;
font-size:21px;
font-weight:800;
border-left:6px solid #22c55e;
padding-left:12px;
margin-bottom:15px
}

.grid{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
gap:14px
}

.field{
background:#f0fdf4;
padding:12px;
border-radius:14px
}

label{
font-weight:700;
font-size:15px;
color:#1f2937
}

input,select{
width:100%;
padding:10px;
margin-top:5px;
border:2px solid #bbf7d0;
border-radius:12px;
font-size:15px;
font-weight:600
}

input:focus{
outline:none;
border-color:#22c55e;
box-shadow:0 0 0 3px rgba(34,197,94,.25)
}

/* BUTTON */
button{
font-weight:900;
letter-spacing:1px;
text-transform:uppercase;
padding:14px 34px;
border:none;
border-radius:18px;
font-size:14px;
cursor:pointer;
transition:.25s;
box-shadow:0 10px 20px rgba(0,0,0,.3)
}

button:hover{
transform:translateY(-3px) scale(1.06);
filter:brightness(1.1)
}

.blue{background:#0ea5e9}
.red{background:#ef4444}


/* TABLE */
table{
width:100%;
border-collapse:collapse;
border-radius:14px;
overflow:hidden
}
th{
background:#14532d;
color:white;
padding:10px;
font-size:14px
}
td{
border:1px solid #ddd;
padding:8px;
text-align:center;
font-size:14px
}
</style>
</head>

<body>
<div class="container">

<div class="header">
PHẦN MỀM QUẢN LÝ QUẤN ĐỘNG CƠ
</div>
<!-- THÔNG TIN CHUNG -->
<div class="card">
<h3>① THÔNG TIN CHUNG</h3>
<div class="grid">
<div class="field"><label>Tên động cơ</label><input id="ten"></div>
<div class="field"><label>Loại</label>
<select id="loai"><option>1 pha</option><option>3 pha</option></select></div>
<div class="field"><label>Công suất</label><input id="cs"></div>
<div class="field"><label>Điện áp</label><input id="ap"></div>
<div class="field"><label>Tụ</label><input id="tu"></div>
<div class="field"><label>Đạn</label><input id="dan"></div>
</div>
</div>

<!-- THÔNG SỐ -->
<div class="card">
<h3>② THÔNG SỐ KỸ THUẬT</h3>
<div class="grid">
<div class="field"><label>Số tua</label><input id="tua"></div>
<div class="field"><label>Ampe</label><input id="ampe"></div>
<div class="field"><label>Kích cỡ Stato</label><input id="stato"></div>
</div>
</div>

<!-- SỐ LIỆU QUẤN -->
<div class="card">
<h3>③ SỐ LIỆU QUẤN</h3>
<div class="grid">
<div class="field"><label>Cuộn KĐ</label><input id="kd"></div>
<div class="field"><label>Dây KĐ</label><input id="daykd"></div>
<div class="field"><label>Cuộn LV</label><input id="lv"></div>
<div class="field"><label>Dây LV</label><input id="daylv"></div>
<div class="field"><label>Kg dây</label><input id="kg"></div>
<div class="field"><label>Ghi chú</label><input id="note"></div>
</div>

<div class="btn-group">
<button onclick="saveData()">LƯU</button>
<button class="blue" onclick="resetForm()">LÀM MỚI</button>
</div>
</div>

<!-- IMPORT EXCEL -->
<div class="card">
<h3>④ NHẬP FILE EXCEL</h3>
<input type="file" id="file" accept=".xlsx">
<button class="blue" onclick="importExcel()">NHẬP FILE</button>
</div>

<!-- TÌM KIẾM -->
<div class="card">
<h3>⑤ TÌM KIẾM</h3>
<input id="search" placeholder="Nhập từ khóa...">
<button onclick="tim()">TÌM</button>
<button class="blue" onclick="showAll()">TẤT CẢ</button>
</div>

<!-- DANH SÁCH -->
<div class="card">
<h3>⑥ DANH SÁCH ĐỘNG CƠ</h3>
<div id="list"></div><br>

<button class="red" onclick="clearAll()">XÓA TẤT CẢ</button>
</div>

</div>

<script>
let data=JSON.parse(localStorage.getItem("motorData"))||[];
let editIndex=null;
showAll();

function saveData(){
let obj={
"Tên":ten.value,"Loại":loai.value,
"Công suất":cs.value,"Điện áp":ap.value,
"Tụ":tu.value,"Đạn":dan.value,
"Số tua":tua.value,"Ampe":ampe.value,
"Stato":stato.value,"KĐ":kd.value,
"Dây KĐ":daykd.value,"LV":lv.value,
"Dây LV":daylv.value,"Kg":kg.value,
"Ghi chú":note.value
}

editIndex!==null?data[editIndex]=obj:data.push(obj);
editIndex=null;
localStorage.setItem("motorData",JSON.stringify(data));
resetForm();showAll();
}

function resetForm(){
document.querySelectorAll("input").forEach(i=>i.value="");
}

function showAll(){render(data);}

function tim(){
let k=search.value.toLowerCase();
render(data.filter(d=>JSON.stringify(d).toLowerCase().includes(k)));
}

function xoa(i){
if(confirm("Xóa dòng này?")){
data.splice(i,1);
localStorage.setItem("motorData",JSON.stringify(data));
showAll();
}
}

function sua(i){
let d=data[i];
ten.value=d["Tên"];loai.value=d["Loại"];
cs.value=d["Công suất"];ap.value=d["Điện áp"];
tu.value=d["Tụ"];dan.value=d["Đạn"];
tua.value=d["Số tua"];ampe.value=d["Ampe"];
stato.value=d["Stato"];kd.value=d["KĐ"];
daykd.value=d["Dây KĐ"];lv.value=d["LV"];
daylv.value=d["Dây LV"];kg.value=d["Kg"];
note.value=d["Ghi chú"];
editIndex=i;
}

function clearAll(){
if(confirm("Xóa toàn bộ dữ liệu?")){
data=[];localStorage.clear();showAll();
}
}

function exportExcel(){
let ws=XLSX.utils.json_to_sheet(data);
let wb=XLSX.utils.book_new();
XLSX.utils.book_append_sheet(wb,ws,"Motor");
XLSX.writeFile(wb,"so_lieu_dong_co.xlsx");
}

function importExcel(){
let f=file.files[0];
if(!f)return;
let r=new FileReader();
r.onload=e=>{
let wb=XLSX.read(e.target.result,{type:"binary"});
let ws=wb.Sheets[wb.SheetNames[0]];
let arr=XLSX.utils.sheet_to_json(ws);
data=data.concat(arr);
localStorage.setItem("motorData",JSON.stringify(data));
showAll();
}
r.readAsBinaryString(f);
}

function render(arr){
if(arr.length==0){list.innerHTML="Chưa có dữ liệu";return;}
let html="<table><tr>";
for(let k in arr[0]) html+=`<th>${k}</th>`;
html+="<th>Thao tác</th></tr>";

arr.forEach((r,i)=>{
html+="<tr>";
for(let k in r) html+=`<td>${r[k]}</td>`;
html+=`
<td>
<button onclick="sua(${i})">Sửa</button>
<button class="red" onclick="xoa(${i})">Xóa</button>
</td></tr>`;
});
html+="</table>";
list.innerHTML=html;
}
</script>
<script>
const API_URL="https://script.google.com/macros/s/AKfycbwfJi-ILnrDcH7xAJ1sL8gTmMVdOy6MYUOg4dHrJ0563mBE9eDKWMZXBtkGJQBEHEsY6A/exec";
let all=[];
let editRow=null;

/* LƯU */
function saveData(){

let obj={
action: editRow? "update":"add",
row: editRow,
ten:ten.value,
loai:loai.value,
cs:cs.value,
ap:ap.value,
tu:tu.value,
dan:dan.value,
tua:tua.value,
ampe:ampe.value,
stato:stato.value,
kd:kd.value,
daykd:daykd.value,
lv:lv.value,
daylv:daylv.value,
kg:kg.value,
note:note.value
};

fetch(API_URL,{
method:"POST",
body:JSON.stringify(obj)
})
.then(r=>r.json())
.then(()=>{
alert(editRow?"Đã cập nhật!":"Đã lưu!");
editRow=null;
resetForm();
loadData();
});
}

/* LOAD */
function loadData(){
fetch(API_URL)
.then(r=>r.json())
.then(d=>{
all=d;
render(d);
});
}

/* SỬA */
function sua(i){
let d=all[i];
editRow=d.row;

ten.value=d["Tên"];
loai.value=d["Loại"];
cs.value=d["Công suất"];
ap.value=d["Điện áp"];
tu.value=d["Tụ"];
dan.value=d["Đạn"];
tua.value=d["Số tua"];
ampe.value=d["Ampe"];
stato.value=d["Stato"];
kd.value=d["KĐ"];
daykd.value=d["Dây KĐ"];
lv.value=d["LV"];
daylv.value=d["Dây LV"];
kg.value=d["Kg"];
note.value=d["Ghi chú"];
}

/* XÓA */
function xoa(i){
if(!confirm("Xóa dòng này trên Google Sheet?"))return;
fetch(API_URL,{
method:"POST",
body:JSON.stringify({
action:"delete",
row:all[i].row
})
})
.then(()=>loadData());
}

function resetForm(){
document.querySelectorAll("input").forEach(i=>i.value="");
}

/* TÌM */
function tim(){
let k=search.value.toLowerCase();
render(all.filter(x=>
JSON.stringify(x).toLowerCase().includes(k)
));
}

/* HIỂN THỊ */
function render(arr){
if(arr.length==0){
list.innerHTML="Chưa có dữ liệu";
return;
}

let h="<table><tr>";
for(let k in arr[0])
if(k!="row" && k!="Thời gian") h+=`<th>${k}</th>`;
h+="<th>Thao tác</th></tr>";

arr.forEach((r,i)=>{
h+="<tr>";
for(let k in r)
if(k!="row" && k!="Thời gian") h+=`<td>${r[k]}</td>`;
h+=`
<td>
<button onclick="sua(${i})">Sửa</button>
<button class="red" onclick="xoa(${i})">Xóa</button>
</td></tr>`;
});

list.innerHTML=h+"</table>";
}



loadData();

</script>


</body>
</html>
